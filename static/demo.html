<!doctype html><meta name=viewport content="width=device-width, initial-scale=1">
<body style="font-family:system-ui;max-width:560px;margin:24px auto;padding:20px">
  <h2>Describe-On-Tap (MVP)</h2>
  <form id="f" style="margin-bottom:20px">
    <div style="margin-bottom:10px">
      <input type="file" name="file" accept="image/*" capture="environment" required style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px">
    </div>
    <div style="margin-bottom:10px">
      <label>Mode:</label>
      <select name="mode" style="margin-left:10px;padding:4px">
        <option value="auto">Auto</option>
        <option value="text">Force Text</option>
        <option value="detail">Force Detail</option>
      </select>
    </div>
    <div style="margin-bottom:10px">
      <label>VLM Model:</label>
      <select name="vlm" style="margin-left:10px;padding:4px">
        <option selected>moondream:v2</option>
        <option>llama3.2:latest</option>
      </select>
    </div>
    <button type="submit" id="submitBtn" style="background:#007bff;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer">Describe</button>
  </form>
  <div id="status" style="margin-bottom:10px;font-weight:bold"></div>
  <pre id="out" style="white-space:pre-wrap;background:#f5f5f5;padding:10px;border-radius:4px;min-height:50px"></pre>
  <audio id="au" controls style="width:100%;margin-top:10px"></audio>
  <script>
    const f = document.getElementById('f');
    const out = document.getElementById('out');
    const au = document.getElementById('au');
    const status = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');
    
    f.onsubmit = async (e) => {
      e.preventDefault();
      console.log('Form submitted');
      
      // Disable button and show loading
      submitBtn.disabled = true;
      submitBtn.textContent = 'Processing...';
      status.textContent = 'Processing your image...';
      out.textContent = '';
      
      try {
        const fd = new FormData(f);
        console.log('Sending request to /analyze');
        const r = await fetch('/analyze', {method:'POST', body:fd});
        console.log('Response received:', r.status);
        
        if (!r.ok) {
          throw new Error(`HTTP error! status: ${r.status}`);
        }
        
        const j = await r.json();
        console.log('JSON response:', j);
        
        status.textContent = 'Description generated successfully!';
        out.textContent = j.description;
        
        if (j.audio) {
          au.src = j.audio;
          au.play().catch((err) => console.log('Audio play error:', err));
        }
      } catch (error) {
        console.error('Error:', error);
        status.textContent = 'Error occurred';
        out.textContent = 'Error: ' + error.message;
      } finally {
        // Re-enable button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Describe';
      }
    };
  </script>
</body>
